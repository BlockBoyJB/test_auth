# test_auth

Часть сервиса аутентификации

### Используемый стек

* **Golang 1.22**
* **Echo** основной веб фреймворк
* **PostgreSQL** как основная БД
* **golang-jwt/jwt** для jwt
* **golang-migrate/migrate** для миграций основной бд
* **logrus** для логирования
* **Docker и Docker Compose** для быстрого развертывания

### Вопросы по тестовому заданию

В процессе разработки я столкнулся с некоторыми вопросами касательно некоторых моментов:

**Обработка входящего ip**  
В задании не сказано о способе развертывания, однако это влияет на способ получения реального ip запроса.
Решил, что достаточно из запроса **_брать RemoteAddr_**, хотя это не будет работать, если сервис будет запущен в docker сети, 
или находится за обратным прокси (например, nginx). В таком случае нужно будет смотреть в какие-то заголовки (или настраивать docker-compose).

**Формат refresh токена**  
В задании указано, что формат можно использовать любой. Можно было использовать обычный uuid и, помимо токена, записывать в БД еще и срок действия.
Решил использовать **_jwt_**, потому что он упростит работу с expiration time, да и будет удобнее с ним работать


### Тестовое задание
Написать часть сервиса аутентификации.

Два REST маршрута:

- Первый маршрут выдает пару Access, Refresh токенов для пользователя с идентификатором (GUID) указанным в параметре запроса
- Второй маршрут выполняет Refresh операцию на пару Access, Refresh токенов

**Требования:**

Access токен тип JWT, алгоритм SHA512, хранить в базе строго запрещено.

Refresh токен тип произвольный, формат передачи base64, хранится в базе исключительно в виде bcrypt хеша, должен быть защищен от изменения на стороне клиента и попыток повторного использования.

Access, Refresh токены обоюдно связаны, Refresh операцию для Access токена можно выполнить только тем Refresh токеном который был выдан вместе с ним.

Payload токенов должен содержать сведения об ip адресе клиента, которому он был выдан. В случае, если ip адрес изменился, при рефреш операции нужно послать email warning на почту юзера (для упрощения можно использовать моковые данные).